<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PratsLab</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Consolas", "Fira Code", monospace;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* Theme Variables */
      :root {
        --bg-primary: #1e1e1e;
        --bg-secondary: #252526;
        --bg-tertiary: #2d2d30;
        --border: #3c3c3c;
        --text-primary: #d4d4d4;
        --text-secondary: #cccccc;
        --accent: #007acc;
        --accent-hover: #005a9e;
        --error: #f48771;
      }

      body {
        background: var(--bg-primary);
        color: var(--text-primary);
      }

      body.theme-pro-transparency {
        background: transparent !important;
      }

      /* Themes */
      .theme-vscode {
        --bg-primary: #1e1e1e;
        --bg-secondary: #252526;
        --bg-tertiary: #2d2d30;
        --border: #3c3c3c;
        --text-primary: #d4d4d4;
        --text-secondary: #cccccc;
        --text-muted: #969696;
        --accent: #007acc;
        --accent-hover: #005a9e;
        --accent-border: #3399ff;
        --error: #f48771;
        --warning: #ffcc02;
        --success: #89d185;
        --syntax-comment: #6a9955;
        --syntax-keyword: #569cd6;
        --syntax-string: #ce9178;
        --syntax-number: #b5cea8;
        --syntax-function: #dcdcaa;
        --syntax-variable: #9cdcfe;
        --terminal-bg: #1e1e1e;
        --terminal-text: #d4d4d4;
        --terminal-cursor: #007acc;
        --button-radius: 6px;
        --shadow-elevate: 0 2px 6px rgba(0, 0, 0, 0.4);
      }

      .theme-black {
        --bg-primary: #000000;
        --bg-secondary: #0a0a0a;
        --bg-tertiary: #1a1a1a;
        --border: #333333;
        --text-primary: #ffffff;
        --text-secondary: #e0e0e0;
        --text-muted: #999999;
        --accent: #ffffff;
        --accent-hover: #cccccc;
        --accent-border: #ffffff;
        --error: #ff6b6b;
        --warning: #ffaa00;
        --success: #00ff88;
        --syntax-comment: #888888;
        --syntax-keyword: #ffffff;
        --syntax-string: #ffaa88;
        --syntax-number: #88ffaa;
        --syntax-function: #aaffff;
        --syntax-variable: #ffaaff;
        --terminal-bg: #000000;
        --terminal-text: #ffffff;
        --terminal-cursor: #ffffff;
        --button-radius: 6px;
        --shadow-elevate: 0 2px 6px rgba(255, 255, 255, 0.2);
      }

      .theme-matrix {
        --bg-primary: #000000;
        --bg-secondary: #001100;
        --bg-tertiary: #002200;
        --border: #00ff00;
        --text-primary: #00ff00;
        --text-secondary: #00cc00;
        --text-muted: #008800;
        --accent: #00ff00;
        --accent-hover: #00cc00;
        --accent-border: #00ff88;
        --error: #ff0000;
        --warning: #ffff00;
        --success: #00ff00;
        --syntax-comment: #008800;
        --syntax-keyword: #00ff00;
        --syntax-string: #00cc88;
        --syntax-number: #88ff00;
        --syntax-function: #00ffaa;
        --syntax-variable: #aaffaa;
        --terminal-bg: #000000;
        --terminal-text: #00ff00;
        --terminal-cursor: #00ff00;
        --button-radius: 6px;
        --shadow-elevate: 0 2px 6px rgba(0, 255, 0, 0.3);
      }

      .theme-tokyo {
        --bg-primary: #0f0f14;
        --bg-secondary: #16161e;
        --bg-tertiary: #1a1b26;
        --border: #24283b;
        --text-primary: #c0caf5;
        --text-secondary: #a9b1d6;
        --text-muted: #565f89;
        --accent: #7aa2f7;
        --accent-hover: #5a7fd4;
        --accent-border: #9abdf5;
        --error: #f7768e;
        --warning: #e0af68;
        --success: #9ece6a;
        --syntax-comment: #565f89;
        --syntax-keyword: #bb9af7;
        --syntax-string: #9ece6a;
        --syntax-number: #ff9e64;
        --syntax-function: #7aa2f7;
        --syntax-variable: #7dcfff;
        --terminal-bg: #0f0f14;
        --terminal-text: #c0caf5;
        --terminal-cursor: #7aa2f7;
        --button-radius: 6px;
        --shadow-elevate: 0 2px 6px rgba(122, 162, 247, 0.3);
      }

      .theme-solarized {
        --bg-primary: #fdf6e3;
        --bg-secondary: #eee8d5;
        --bg-tertiary: #e3dcc6;
        --border: #d3af86;
        --text-primary: #586e75;
        --text-secondary: #657b83;
        --text-muted: #93a1a1;
        --accent: #268bd2;
        --accent-hover: #2aa198;
        --accent-border: #6c71c4;
        --error: #dc322f;
        --warning: #b58900;
        --success: #859900;
        --syntax-comment: #93a1a1;
        --syntax-keyword: #859900;
        --syntax-string: #2aa198;
        --syntax-number: #d33682;
        --syntax-function: #268bd2;
        --syntax-variable: #6c71c4;
        --terminal-bg: #fdf6e3;
        --terminal-text: #586e75;
        --terminal-cursor: #268bd2;
        --button-radius: 6px;
        --shadow-elevate: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      .theme-monokai-dimmed {
        --bg-primary: #1e1f1c;
        --bg-secondary: #2f2f2a;
        --bg-tertiary: #3a3a35;
        --border: #5a5a50;
        --text-primary: #c5c8c6;
        --text-secondary: #a8a8a2;
        --text-muted: #75715e;
        --accent: #8ac6f2;
        --accent-hover: #e06c75;
        --accent-border: #66d9ef;
        --error: #e06c75;
        --warning: #e6db74;
        --success: #a6e22e;
        --syntax-comment: #75715e;
        --syntax-keyword: #f92672;
        --syntax-string: #e6db74;
        --syntax-number: #ae81ff;
        --syntax-function: #a6e22e;
        --syntax-variable: #66d9ef;
        --terminal-bg: #1e1f1c;
        --terminal-text: #c5c8c6;
        --terminal-cursor: #8ac6f2;
        --button-radius: 6px;
        --shadow-elevate: 0 2px 6px rgba(0, 0, 0, 0.4);
      }

      /* üé® VS Code Dark Modern Theme */
      .theme-dark-modern {
        /* ===== Base UI Colors ===== */
        --bg-primary: #0f0f0f; /* Much darker editor background */
        --bg-secondary: #141414; /* Very dark sidebar */
        --bg-tertiary: #1a1a1a; /* Darker tabs/header */
        --border: #2a2a2a; /* Darker borders */

        /* ===== Text Colors ===== */
        --text-primary: #d4d4d4; /* Light gray text */
        --text-secondary: #c5c5c5; /* Dimmed gray */
        --text-muted: #858585; /* Muted gray */

        /* ===== Accent & Interaction ===== */
        --accent: #007acc; /* VS Code blue */
        --accent-hover: #005a9e; /* Darker blue hover */
        --accent-border: #3399ff; /* Light blue border */

        /* ===== Syntax Highlighting ===== */
        --syntax-comment: #6a9955; /* Green comments */
        --syntax-keyword: #569cd6; /* Blue keywords */
        --syntax-string: #ce9178; /* Orange strings */
        --syntax-number: #b5cea8; /* Light green numbers */
        --syntax-function: #dcdcaa; /* Yellow functions */
        --syntax-variable: #9cdcfe; /* Cyan variables */
        --syntax-class: #4ec9b0; /* Teal classes */

        /* ===== Status / Feedback ===== */
        --error: #f48771; /* Red errors */
        --warning: #cca700; /* Orange warnings */
        --success: #89d185; /* Green success */

        /* ===== Terminal ===== */
        --terminal-bg: #0f0f0f; /* Match editor */
        --terminal-text: #d4d4d4;
        --terminal-cursor: #007acc;

        /* ===== UI Elements ===== */
        --button-radius: 6px;
        --shadow-elevate: 0 2px 6px rgba(0, 0, 0, 0.6);
      }

      .header {
        background: var(--bg-tertiary);
        padding: 8px 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border);
        font-size: 14px;
        flex-shrink: 0;
      }

      .logo {
        font-weight: bold;
        color: var(--accent);
        font-size: 16px;
      }

      .theme-selector {
        position: relative;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .theme-dropdown {
        background: var(--bg-tertiary);
        border: 1px solid var(--border);
        color: var(--text-secondary);
        padding: 6px 12px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
        min-width: 120px;
      }

      .theme-dropdown:hover {
        background: var(--border);
      }

      .theme-menu {
        position: absolute;
        top: 100%;
        right: 0;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 4px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        min-width: 150px;
        display: none;
      }

      .theme-menu.show {
        display: block;
      }

      .theme-option {
        padding: 8px 12px;
        cursor: pointer;
        font-size: 12px;
        border-bottom: 1px solid var(--border);
        transition: background 0.2s;
      }

      .theme-option:last-child {
        border-bottom: none;
      }

      .theme-option:hover {
        background: var(--bg-tertiary);
      }

      .theme-option.active {
        background: var(--accent);
        color: var(--bg-primary);
      }

      .fullscreen-btn {
        background: var(--accent);
        color: var(--bg-primary);
        border: none;
        padding: 6px 12px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        margin-left: 8px;
      }

      .container {
        flex: 1;
        display: flex;
        align-items: stretch;
        min-height: 0;
      }

      .sidebar {
        width: 250px;
        min-width: 100px;
        max-width: 500px;
        background: var(--bg-secondary);
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
        transition: none;
        overflow: hidden;
      }

      .sidebar-resizer {
        width: 4px;
        background: transparent;
        cursor: col-resize;
        flex-shrink: 0;
        border-right: 1px solid var(--border);
      }

      .sidebar-resizer:hover {
        background: var(--accent);
      }

      .sidebar.hidden {
        width: 0;
        min-width: 0;
        resize: none;
        overflow: hidden;
      }

      .sidebar-header {
        padding: 8px 12px;
        background: var(--bg-tertiary);
        border-bottom: 1px solid var(--border);
        font-size: 12px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .explorer-actions {
        display: flex;
        gap: 4px;
        opacity: 0;
        transition: opacity 0.2s;
      }

      .sidebar-header:hover .explorer-actions {
        opacity: 1;
      }

      .explorer-action {
        background: transparent;
        border: none;
        color: var(--text-secondary);
        padding: 4px;
        border-radius: 3px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        transition: all 0.2s;
      }

      .explorer-action:hover {
        background: var(--border);
        color: var(--text-primary);
      }

      .file-tree {
        flex: 1;
        padding: 8px;
        overflow-y: auto;
      }

      .folder-item {
        padding: 4px 8px;
        cursor: pointer;
        border-radius: 3px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
        user-select: none;
        position: relative;
      }

      .folder-item:hover {
        background: var(--bg-tertiary);
      }



      .folder-item.expanded {
        color: var(--text-primary);
      }

      .folder-contents {
        margin-left: 16px;
        display: none;
      }

      .folder-contents.expanded {
        display: block;
      }

      .file-item.in-folder {
        margin-left: 16px;
      }

      .inline-input {
        background: var(--bg-primary);
        border: 1px solid var(--accent);
        color: var(--text-primary);
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 13px;
        font-family: inherit;
        outline: none;
        width: 150px;
      }

      .context-menu {
        position: fixed;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 4px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        z-index: 10000;
        min-width: 160px;
        display: none;
        padding: 4px 0;
      }

      .context-menu.show {
        display: block;
      }

      .context-menu-item {
        padding: 8px 16px;
        cursor: pointer;
        font-size: 13px;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background 0.2s;
      }

      .context-menu-item:hover {
        background: var(--accent);
        color: var(--bg-primary);
      }

      .context-menu-separator {
        height: 1px;
        background: var(--border);
        margin: 4px 0;
      }

      .file-item {
        padding: 4px 8px;
        cursor: pointer;
        border-radius: 3px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
        user-select: none;
      }

      .file-item:hover {
        background: var(--bg-tertiary);
      }

      .file-item.active {
        background: var(--accent);
        color: var(--bg-primary);
      }



      .editor-panel {
        flex: 1;
        min-width: 200px;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--border);
        height: 100%;
        overflow: hidden;
      }

      .editor-panel #editor {
        flex: 1;
      }

      .output-panel {
        width: 50%;
        min-width: 200px;
        display: flex;
        flex-direction: column;
        background: var(--bg-secondary);
        flex-shrink: 0;
        overflow: hidden;
        height: 100%;
      }

      .terminal-tabs {
        display: flex;
        align-items: center; /* vertical center for tabs and + button */
        background: var(--bg-tertiary);
        border-bottom: 1px solid var(--border);
        overflow-x: auto;
        flex-shrink: 0;
        min-height: 40px;
        height: 40px; /* normalize header height */
        width: 100%;
        box-sizing: border-box;
        padding: 0 8px; /* breathing room on edges */
        gap: 0;
      }

      .terminal-tab {
        padding: 8px 12px;
        background: transparent;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 12px;
        border-right: 1px solid var(--border);
        display: flex;
        align-items: center;
        height: 32px; /* consistent pill height */
        gap: 6px;
        min-width: 120px;
      }

      .terminal-tab.active {
        background: var(--bg-primary);
        color: var(--text-primary);
      }

      .terminal-tab:hover {
        background: var(--bg-secondary);
      }

      .tab-close {
        color: var(--text-secondary);
        cursor: pointer;
        font-weight: bold;
        padding: 2px 4px;
        margin-left: 4px;
      }

      .terminal-content {
        flex: 1;
        display: none;
        flex-direction: column;
        min-height: 0;
        height: 100%;
      }

      .terminal-content.active {
        display: flex;
      }

      #terminalContainer {
        flex: 1;
        min-height: 0;
        overflow: hidden;
      }

      .add-terminal {
        background: var(--accent);
        color: var(--bg-primary);
        border: 1px solid var(--accent-border);
        padding: 6px 12px;
        cursor: pointer;
        font-size: 12px;
        flex-shrink: 0;
        margin-left: auto; /* push to right */
        margin-right: 8px; /* away from edge */
        border-radius: var(--button-radius);
        height: 32px; /* match tab height */
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .resizer {
        width: 4px;
        background: transparent;
        cursor: col-resize;
        transition: background 0.2s;
        border-right: 1px solid var(--border);
        flex-shrink: 0;
      }

      .resizer:hover {
        background: var(--accent);
      }

      #editor {
        flex: 1;
        padding-top: 12px;
        direction: ltr;
        text-align: left;
        font-variant-ligatures: none;
      }

      /* Fix Monaco Editor cursor positioning */
      #editor .monaco-editor {
        direction: ltr !important;
      }

      #editor .monaco-editor .view-lines {
        direction: ltr !important;
      }

      /* Fix cursor visual positioning - minimal interference */
      #editor .monaco-editor .view-lines .view-line {
        font-variant-ligatures: none !important;
      }

      /* Fix text rendering for accurate cursor position */
      #editor .monaco-editor .view-lines .view-line span {
        font-variant-ligatures: none !important;
      }

      .bottom-bar {
        background: var(--bg-tertiary);
        border-top: 1px solid var(--border);
        padding: 12px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
        flex-shrink: 0;
        transition: transform 0.3s ease;
      }

      .bottom-bar.hidden {
        transform: translateY(100%);
      }

      .bottom-bar-left {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .bottom-bar-right {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .toggle-sidebar {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text-secondary);
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.2s;
      }

      .toggle-sidebar:hover {
        background: var(--border);
        transform: translateY(-1px);
      }

      .run-btn {
        background: var(--accent);
        color: var(--bg-primary);
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .run-btn:hover {
        background: var(--accent-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 122, 204, 0.3);
      }

      .output-header {
        padding: 8px 12px; /* match tabs padding */
        background: var(--bg-tertiary);
        border-bottom: 1px solid var(--border);
        font-size: 12px;
        color: var(--text-secondary);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
        min-height: 40px;
        height: 40px; /* align with tabs */
        width: 100%;
        box-sizing: border-box;
      }

      .output-content {
        flex: 1;
        padding: 12px;
        overflow-y: auto;
        min-height: 0;
        font-family: "Fira Code", "Consolas", monospace;
        font-size: 13px;
        line-height: 1.5;
        background: var(--bg-primary);
      }

      .terminal-input {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        background: var(--bg-primary);
        border-top: 1px solid var(--border);
        gap: 8px;
      }

      .prompt {
        color: var(--accent);
        font-weight: bold;
        font-family: "Fira Code", "Consolas", monospace;
      }

      .input-line {
        flex: 1;
        background: transparent;
        border: none;
        color: var(--text-primary);
        font-family: "Fira Code", "Consolas", monospace;
        font-size: 13px;
        outline: none;
        direction: ltr;
        text-align: left;
        text-indent: 0;
      }

      .input-line::placeholder {
        color: var(--text-secondary);
        opacity: 0.6;
      }

      .log-entry {
        margin-bottom: 6px;
        white-space: pre-wrap;
        padding: 4px 8px;
        border-radius: 3px;
        border-left: 3px solid var(--accent);
        background: var(--bg-secondary);
      }

      .log-error {
        color: var(--error);
        border-left-color: var(--error);
      }

      .log-info {
        color: var(--text-primary);
      }

      .clear-btn {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border);
        padding: 4px 8px;
        border-radius: var(--button-radius);
        cursor: pointer;
        font-size: 11px;
        transition: all 0.2s;
        height: 28px; /* look consistent with tabs */
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .clear-btn:hover {
        background: var(--border);
        color: var(--text-primary);
      }

      /* Fullscreen styles */
      .fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
      }

      /* About Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10000;
      }

      .modal-overlay.show {
        display: flex;
      }

      .modal {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 24px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      }

      .modal h2 {
        color: var(--accent);
        margin-bottom: 16px;
        font-size: 24px;
      }

      .modal p {
        color: var(--text-primary);
        line-height: 1.6;
        margin-bottom: 12px;
      }

      .modal .contact {
        color: var(--accent);
        font-weight: bold;
        margin-top: 16px;
      }

      .modal-close {
        background: var(--accent);
        color: var(--bg-primary);
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 16px;
        font-size: 14px;
      }

      .modal-close:hover {
        background: var(--accent-hover);
      }

      .logo i {
        cursor: pointer;
        transition: transform 0.2s ease;
        display: inline-block;
      }

      .logo i:hover,
      .logo i svg:hover {
        transform: scale(1.3);
      }

      .logo svg {
        transition: transform 0.2s ease;
      }

      /* 3 seconds fast gradient, then 3 seconds slow to permanent color */
      @keyframes blueGradient {
        0% {
          color: #60a5fa;
        }
        5% {
          color: #3b82f6;
        }
        10% {
          color: #0ea5e9;
        }
        15% {
          color: #38bdf8;
        }
        20% {
          color: #0284c7;
        }
        25% {
          color: #60a5fa;
        }
        30% {
          color: #3b82f6;
        }
        35% {
          color: #0ea5e9;
        }
        40% {
          color: #38bdf8;
        }
        45% {
          color: #0284c7;
        }
        50% {
          color: #60a5fa;
        }
        100% {
          color: var(--accent);
        }
      }

      .logo-startup {
        animation: blueGradient 6s ease-in-out forwards;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-secondary);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--accent);
      }

      /* Monaco Editor scrollbar */
      #editor .monaco-scrollable-element > .scrollbar > .slider {
        background: var(--border) !important;
        border-radius: 6px !important;
      }

      #editor .monaco-scrollable-element > .scrollbar > .slider:hover {
        background: var(--accent) !important;
      }

      #editor .monaco-scrollable-element > .scrollbar.vertical {
        width: 6px !important;
      }

      #editor .monaco-scrollable-element > .scrollbar.horizontal {
        height: 6px !important;
      }

      #editor .monaco-scrollable-element > .scrollbar {
        background: transparent !important;
      }

      /* Hide overview ruler decorations */
      #editor .decorationsOverviewRuler {
        display: none !important;
      }

      #editor .monaco-editor .overview-ruler {
        display: none !important;
      }

      /* Responsive layout for smaller viewports */
      @media (max-width: 1200px) {
        .sidebar {
          min-width: 80px;
        }
        .editor-panel {
          min-width: 150px;
        }
        .output-panel {
          min-width: 150px;
        }
      }

      @media (max-width: 900px) {
        .container {
          flex-direction: column;
        }
        .output-panel {
          width: 100%;
          height: 40%;
        }
        .editor-panel {
          height: 60%;
        }
        .resizer {
          width: 100%;
          height: 4px;
          cursor: row-resize;
        }
      }
    </style>
    <link rel="icon" type="image/jpeg" href="img1.jpg" />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://pyscript.net/releases/2024.1.1/core.css"
    />
    <script
      type="module"
      src="https://pyscript.net/releases/2024.1.1/core.js"
    ></script>
    <script src="https://unpkg.com/feather-icons"></script>
  </head>
  <body class="theme-vscode">
    <script>
      // Apply saved theme immediately to prevent flashing
      (function() {
        const savedTheme = localStorage.getItem('jsPlaygroundTheme') || 'vscode';
        document.body.className = `theme-${savedTheme}`;
      })();
    </script>
    <div class="header">
      <div class="logo">
        <span><i data-feather="zap" onclick="showAbout()"></i> PratsLab</span>
      </div>
      <div class="theme-selector">
        <div class="theme-dropdown" onclick="toggleThemeMenu()">
          <i data-feather="palette"></i>
          <span id="currentTheme">VS Code</span>
          <i data-feather="chevron-down"></i>
        </div>
        <div class="theme-menu" id="themeMenu">
          <div
            class="theme-option active"
            onclick="selectTheme('vscode', 'VS Code')"
          >
            VS Code
          </div>
          <div class="theme-option" onclick="selectTheme('black', 'Black')">
            Black
          </div>
          <div class="theme-option" onclick="selectTheme('matrix', 'Matrix')">
            Matrix
          </div>
          <div
            class="theme-option"
            onclick="selectTheme('tokyo', 'Tokyo Night')"
          >
            Tokyo Night
          </div>
          <div
            class="theme-option"
            onclick="selectTheme('solarized', 'Solarized Light')"
          >
            Solarized Light
          </div>
          <div
            class="theme-option"
            onclick="selectTheme('monokai-dimmed', 'Monokai Dimmed')"
          >
            Monokai Dimmed
          </div>
          <div
            class="theme-option"
            onclick="selectTheme('dark-modern', 'Dark Modern')"
          >
            Dark Modern
          </div>
        </div>
        <button class="fullscreen-btn" onclick="toggleFullscreen()">
          <i data-feather="maximize"></i> Fullscreen
        </button>
      </div>
    </div>
    <div class="container">
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <span><i data-feather="folder"></i> EXPLORER</span>
          <div class="explorer-actions">
            <button class="explorer-action" onclick="createNewFile()" title="New File">
              <i data-feather="file-plus"></i>
            </button>
            <button class="explorer-action" onclick="createNewFolder()" title="New Folder">
              <i data-feather="folder-plus"></i>
            </button>
          </div>
        </div>
        <div class="file-tree" id="fileTree"></div>
      </div>
      <div class="sidebar-resizer" id="sidebarResizer"></div>
      <div class="editor-panel">
        <div id="editor"></div>
      </div>
      <div class="resizer" id="resizer"></div>
      <div class="output-panel">
        <div class="terminal-tabs" id="terminalTabs">
          <button class="add-terminal" onclick="addTerminal()">
            <i data-feather="plus"></i> Terminal
          </button>
        </div>
        <div id="terminalContainer"></div>
      </div>
    </div>

    <!-- Full Width Bottom Bar -->
    <div class="bottom-bar" id="bottomBar">
      <div class="bottom-bar-left">
        <button class="toggle-sidebar" onclick="toggleSidebar()">
          <i data-feather="sidebar"></i> Explorer
        </button>
      </div>
      <div class="bottom-bar-right">
        <span
          style="
            font-size: 11px;
            color: var(--text-secondary);
            margin-right: 12px;
          "
          >Ctrl+Enter: Run | Ctrl+B: Explorer
        </span>
        <button class="run-btn" onclick="runCode()">
          <i data-feather="play"></i> Run Code
        </button>
      </div>
    </div>

    <!-- About Modal -->
    <div class="modal-overlay" id="aboutModal">
      <div class="modal">
        <h2>üéâ About PratsLab</h2>
        <p>
          This is made by Prats for full focus without any ads. Fullscreen mode
          to code and test.
        </p>
        <p>This has Python and JavaScript language compatibility.</p>
        <p class="contact">Any queries? Please contact me:</p>
        <p class="contact">
          Instagram: <a href="https://www.instagram.com/yourboy_prats" target="_blank" 
             style="
               display: inline-block;
               background: rgba(0, 122, 204, 0.2);
               color: var(--accent);
               padding: 4px 8px;
               border-radius: 4px;
               text-decoration: none;
               transition: all 0.2s;
               border: 1px solid rgba(0, 122, 204, 0.3);
             "
             onmouseover="this.style.background='rgba(0, 122, 204, 0.3)'"
             onmouseout="this.style.background='rgba(0, 122, 204, 0.2)'">
            @yourboy_prats
          </a>
        </p>
        <div
          style="
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
          "
        >
          <button class="modal-close" onclick="showUpdates()">
            üöÄ New Features
          </button>
          <button class="modal-close" onclick="hideAbout()">Close</button>
        </div>
      </div>
    </div>

    <!-- New Features Modal -->
    <div class="modal-overlay" id="updatesModal">
      <div class="modal" style="max-width: 600px">
        <h2>üöÄ New Features</h2>
        <div style="text-align: left; max-height: 400px; overflow-y: auto">
          <h3 style="color: var(--accent); margin: 16px 0 8px 0">
            üéØ What's New for You:
          </h3>
          <br />

          <div style="margin-bottom: 16px">
            <h4
              style="
                color: var(--accent);
                margin-bottom: 4px;
                vertical-align: top;
              "
            >
              üìÅ VS Code-Style File Explorer
            </h4>
            <p style="margin-bottom: 8px; font-size: 14px; margin-left: 24px">
              Create folders, organize files, and manage your projects just like in VS Code
            </p>
          </div>

          <div style="margin-bottom: 16px">
            <h4
              style="
                color: var(--accent);
                margin-bottom: 4px;
                vertical-align: top;
              "
            >
              üñ±Ô∏è Right-Click File Management
            </h4>
            <p style="margin-bottom: 8px; font-size: 14px; margin-left: 24px">
              Right-click anywhere to create, rename, copy, or delete files and folders
            </p>
          </div>

          <div style="margin-bottom: 16px">
            <h4
              style="
                color: var(--accent);
                margin-bottom: 4px;
                vertical-align: top;
              "
            >
              üíæ Smart Session Memory
            </h4>
            <p style="margin-bottom: 8px; font-size: 14px; margin-left: 24px">
              Remembers your last opened file and theme - pick up exactly where you left off
            </p>
          </div>

          <div style="margin-bottom: 16px">
            <h4
              style="
                color: var(--accent);
                margin-bottom: 4px;
                vertical-align: top;
              "
            >
              üé® 7 Beautiful Themes
            </h4>
            <p style="margin-bottom: 8px; font-size: 14px; margin-left: 24px">
              VS Code, Dark Modern, Tokyo Night, Matrix, and more - with instant preview
            </p>
          </div>

          <div style="margin-bottom: 16px">
            <h4
              style="
                color: var(--accent);
                margin-bottom: 4px;
                vertical-align: top;
              "
            >
              üßπ Clean Terminal Output
            </h4>
            <p style="margin-bottom: 8px; font-size: 14px; margin-left: 24px">
              Shows only your code results or "Code executed successfully" - no clutter
            </p>
          </div>

          <div style="margin-bottom: 16px">
            <h4
              style="
                color: var(--accent);
                margin-bottom: 4px;
                vertical-align: top;
              "
            >
              ‚ö° Zero Flicker Experience
            </h4>
            <p style="margin-bottom: 8px; font-size: 14px; margin-left: 24px">
              Smooth reloads with no theme flashing - professional feel throughout
            </p>
          </div>
        </div>
        <button class="modal-close" onclick="hideUpdates()">Close</button>
      </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu"></div>

    <script src="https://unpkg.com/monaco-editor@0.44.0/min/vs/loader.js"></script>
    <script>
      let editor;
      let isResizing = false;
      let currentTheme = localStorage.getItem('jsPlaygroundTheme') || 'vscode';
      let isFullscreen = false;
      let terminals = [];
      let activeTerminal = 0;

      let files = {};
      let folders = {};
      let expandedFolders = new Set();
      let contextTarget = null;
      let contextType = null;

      // Load files from localStorage or use defaults
      function loadFilesFromStorage() {
        const savedFiles = localStorage.getItem("jsPlaygroundFiles");
        const savedFolders = localStorage.getItem("jsPlaygroundFolders");
        
        if (savedFiles) {
          files = JSON.parse(savedFiles);
        } else {
          files = {
            "main.js":
              '// üéâ Hello Friend! Welcome to the JS Playground! Made by ur frnd prats üöÄ\nconsole.log("Hello, World! üëã");',
            "hello.py":
              '# üéâ Hello Friend! Welcome to the JS Playground! Made by ur frnd prats üöÄ\nprint("Hello, Python World! üëã")',
          };
          saveFilesToStorage();
        }
        
        if (savedFolders) {
          folders = JSON.parse(savedFolders);
        }
      }

      // Save files to localStorage
      function saveFilesToStorage() {
        localStorage.setItem("jsPlaygroundFiles", JSON.stringify(files));
        localStorage.setItem("jsPlaygroundCurrentFile", currentFile);
      }
      
      // Load current file from localStorage or use default
      function loadCurrentFile() {
        const savedCurrentFile = localStorage.getItem("jsPlaygroundCurrentFile");
        if (savedCurrentFile && files[savedCurrentFile]) {
          return savedCurrentFile;
        }
        return "main.js";
      }
      
      let currentFile = "main.js";
      let sidebarVisible = true;
      let bottomBarVisible = true;
      let isResizingSidebar = false;

      // Block browser dialogs in parent window
      const originalPrompt = window.prompt;
      const originalAlert = window.alert;
      const originalConfirm = window.confirm;

      window.prompt = function (message, defaultValue) {
        console.log("PROMPT: " + message + " (Using default: 5)");
        return defaultValue || "5";
      };
      window.alert = function () {};
      window.confirm = function () {
        return false;
      };

      // Define custom Monaco themes
      function defineCustomThemes() {
        monaco.editor.defineTheme("black-theme", {
          base: "vs-dark",
          inherit: true,
          rules: [
            { token: "comment", foreground: "666666" },
            { token: "keyword", foreground: "ffffff", fontStyle: "bold" },
            { token: "string", foreground: "cccccc" },
            { token: "number", foreground: "ffffff" },
          ],
          colors: {
            "editor.background": "#000000",
            "editor.foreground": "#ffffff",
            "editor.lineHighlightBackground": "#0a0a0a",
            "editorCursor.foreground": "#ffffff",
            "editor.selectionBackground": "#333333",
          },
        });

        monaco.editor.defineTheme("matrix-theme", {
          base: "vs-dark",
          inherit: true,
          rules: [
            { token: "comment", foreground: "008800" },
            { token: "keyword", foreground: "00ff00", fontStyle: "bold" },
            { token: "string", foreground: "00cc00" },
            { token: "number", foreground: "00ff00" },
          ],
          colors: {
            "editor.background": "#000000",
            "editor.foreground": "#00ff00",
            "editor.lineHighlightBackground": "#001100",
            "editorCursor.foreground": "#00ff00",
            "editor.selectionBackground": "#002200",
          },
        });

        monaco.editor.defineTheme("tokyo-theme", {
          base: "vs-dark",
          inherit: true,
          rules: [
            { token: "comment", foreground: "565f89" },
            { token: "keyword", foreground: "7aa2f7", fontStyle: "bold" },
            { token: "string", foreground: "9ece6a" },
            { token: "number", foreground: "ff9e64" },
          ],
          colors: {
            "editor.background": "#0f0f14",
            "editor.foreground": "#c0caf5",
            "editor.lineHighlightBackground": "#16161e",
            "editorCursor.foreground": "#c0caf5",
            "editor.selectionBackground": "#24283b",
          },
        });

        monaco.editor.defineTheme("solarized-theme", {
          base: "vs",
          inherit: true,
          rules: [
            { token: "comment", foreground: "93a1a1" },
            { token: "keyword", foreground: "268bd2", fontStyle: "bold" },
            { token: "string", foreground: "2aa198" },
            { token: "number", foreground: "d33682" },
          ],
          colors: {
            "editor.background": "#fdf6e3",
            "editor.foreground": "#586e75",
            "editor.lineHighlightBackground": "#eee8d5",
            "editorCursor.foreground": "#586e75",
            "editor.selectionBackground": "#d3af86",
          },
        });

        monaco.editor.defineTheme("monokai-dimmed-theme", {
          base: "vs-dark",
          inherit: true,
          rules: [
            { token: "comment", foreground: "5a5a50" },
            { token: "keyword", foreground: "8ac6f2", fontStyle: "bold" },
            { token: "string", foreground: "98c379" },
            { token: "number", foreground: "d19a66" },
          ],
          colors: {
            "editor.background": "#1e1f1c",
            "editor.foreground": "#c5c8c6",
            "editor.lineHighlightBackground": "#2f2f2a",
            "editorCursor.foreground": "#c5c8c6",
            "editor.selectionBackground": "#3a3a35",
          },
        });

        monaco.editor.defineTheme("pro-transparency-theme", {
          base: "vs-dark",
          inherit: true,
          rules: [
            { token: "comment", foreground: "888888" },
            { token: "keyword", foreground: "00d4ff", fontStyle: "bold" },
            { token: "string", foreground: "98fb98" },
            { token: "number", foreground: "ffa500" },
          ],
          colors: {
            "editor.background": "#00000000",
            "editor.foreground": "#ffffff",
            "editor.lineHighlightBackground": "#ffffff10",
            "editorCursor.foreground": "#00d4ff",
            "editor.selectionBackground": "#ffffff20",
          },
        });

        monaco.editor.defineTheme("dark-modern-theme", {
          base: "vs-dark",
          inherit: true,
          rules: [
            { token: "comment", foreground: "6A9955" },
            { token: "keyword", foreground: "569CD6" },
            { token: "string", foreground: "CE9178" },
            { token: "number", foreground: "B5CEA8" },
            { token: "constant", foreground: "B5CEA8" },
            { token: "function", foreground: "569CD6" },
            { token: "entity.name.function", foreground: "569CD6" },
            { token: "support.function", foreground: "569CD6" },
          ],
          colors: {
            "editor.background": "#1E1E1E",
            "editor.foreground": "#D4D4D4",
            "editor.lineHighlightBackground": "#333333",
            "editorCursor.foreground": "#AEAFAD",
            "editor.selectionBackground": "#264F78",
            "editor.lineNumber.foreground": "#858585",
            "editor.lineNumber.activeForeground": "#C6C6C6",
          },
        });
      }

      // Theme mappings for Monaco Editor
      const monacoThemes = {
        vscode: "vs-dark",
        black: "black-theme",
        matrix: "matrix-theme",
        tokyo: "tokyo-theme",
        solarized: "solarized-theme",
        "monokai-dimmed": "monokai-dimmed-theme",
        "dark-modern": "dark-modern-theme",
      };

      // Initialize Monaco Editor
      require.config({
        paths: { vs: "https://unpkg.com/monaco-editor@0.44.0/min/vs" },
      });
      require(["vs/editor/editor.main"], function () {
        // Load files first
        loadFilesFromStorage();
        
        // Load last opened file
        currentFile = loadCurrentFile();

        // Define custom themes first
        defineCustomThemes();

        // Determine initial language
        const extension = currentFile.split(".").pop().toLowerCase();
        const initialLanguage = extension === "py" ? "python" : "javascript";

        editor = monaco.editor.create(document.getElementById("editor"), {
          value: files[currentFile] || "",
          language: initialLanguage,
          theme: monacoThemes[currentTheme],
          fontSize: 14,
          fontFamily: "Consolas, Monaco, 'Courier New', monospace",
          fontLigatures: false,
          minimap: { enabled: false },
          scrollBeyondLastLine: false,
          automaticLayout: true,
          wordWrap: "on",
          lineNumbers: "on",
          folding: true,
          bracketMatching: "always",
          bracketPairColorization: { enabled: false },
          guides: { bracketPairs: false },
          overviewRulerLanes: 0,
          renderLineHighlight: "none",
          occurrencesHighlight: false,
          selectionHighlight: false,
          hideCursorInOverviewRuler: true,
          find: { addExtraSpaceOnTop: false, autoFindInSelection: false },
        });

        // Ensure proper initialization
        setTimeout(() => {
          if (editor) {
            editor.layout();
            editor.focus();
          }
        }, 100);

        // Keyboard shortcuts
        editor.addCommand(
          monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter,
          runCode
        );
        editor.addCommand(
          monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyB,
          toggleSidebar
        );

        // Auto-save on change
        editor.onDidChangeModelContent(() => {
          files[currentFile] = editor.getValue();
          saveFilesToStorage();
        });

        // Initialize UI
        renderFileTree();
        addTerminal();

        // Initialize Feather icons
        setTimeout(() => {
          feather.replace();

          // Add hover effect to logo lightning icon
          const logoZapIcon = document.querySelector(
            '.logo [data-feather="zap"]'
          );
          const logoZapSvg = document.querySelector(".logo svg");

          if (logoZapIcon) {
            logoZapIcon.style.transition = "transform 0.2s ease";
            logoZapIcon.addEventListener("mouseenter", () => {
              logoZapIcon.style.transform = "scale(1.2)";
            });
            logoZapIcon.addEventListener("mouseleave", () => {
              logoZapIcon.style.transform = "scale(1)";
            });
          }

          if (logoZapSvg) {
            logoZapSvg.style.transition = "transform 0.2s ease";
            logoZapSvg.addEventListener("mouseenter", () => {
              logoZapSvg.style.transform = "scale(1.2)";
            });
            logoZapSvg.addEventListener("mouseleave", () => {
              logoZapSvg.style.transform = "scale(1)";
            });

            // Add colorful animation for first 5 seconds
            logoZapSvg.classList.add("logo-startup");
            setTimeout(() => {
              logoZapSvg.classList.remove("logo-startup");
            }, 5000);
          }
        }, 100);
      });

      // Theme management
      let selectedThemeIndex = 0;
      const themeOptions = [
        { key: "vscode", name: "VS Code" },
        { key: "black", name: "Black" },
        { key: "matrix", name: "Matrix" },
        { key: "tokyo", name: "Tokyo Night" },
        { key: "solarized", name: "Solarized Light" },
        { key: "monokai-dimmed", name: "Monokai Dimmed" },
        { key: "dark-modern", name: "Dark Modern" },
      ];

      function toggleThemeMenu() {
        const menu = document.getElementById("themeMenu");
        const isOpening = !menu.classList.contains("show");
        menu.classList.toggle("show");

        if (isOpening) {
          // Find current theme index
          selectedThemeIndex = themeOptions.findIndex(
            (t) => t.key === currentTheme
          );
          if (selectedThemeIndex === -1) selectedThemeIndex = 0;
          updateThemeSelection();

          // Add keyboard listener
          document.addEventListener("keydown", handleThemeNavigation);
        } else {
          // Remove keyboard listener
          document.removeEventListener("keydown", handleThemeNavigation);
        }
      }

      function selectTheme(theme, displayName) {
        currentTheme = theme;
        document.body.className = `theme-${theme}`;

        // Update dropdown display
        document.getElementById("currentTheme").textContent = displayName;

        // Update active option
        document
          .querySelectorAll(".theme-option")
          .forEach((opt) => opt.classList.remove("active"));
        event.target.classList.add("active");

        // Update Monaco theme if editor is loaded
        if (editor && monaco && monacoThemes[theme]) {
          try {
            monaco.editor.setTheme(monacoThemes[theme]);
          } catch (e) {
            console.log("Theme not ready, retrying...");
            setTimeout(() => {
              if (monaco && monacoThemes[theme]) {
                monaco.editor.setTheme(monacoThemes[theme]);
              }
            }, 100);
          }
        }

        // Close menu
        document.getElementById("themeMenu").classList.remove("show");

        localStorage.setItem("jsPlaygroundTheme", theme);
        localStorage.setItem("jsPlaygroundThemeDisplay", displayName);
      }

      function handleThemeNavigation(e) {
        const menu = document.getElementById("themeMenu");
        if (!menu.classList.contains("show")) return;

        if (e.key === "ArrowDown") {
          e.preventDefault();
          selectedThemeIndex = (selectedThemeIndex + 1) % themeOptions.length;
          updateThemeSelection();
          previewTheme(themeOptions[selectedThemeIndex]);
        } else if (e.key === "ArrowUp") {
          e.preventDefault();
          selectedThemeIndex =
            (selectedThemeIndex - 1 + themeOptions.length) %
            themeOptions.length;
          updateThemeSelection();
          previewTheme(themeOptions[selectedThemeIndex]);
        } else if (e.key === "Enter") {
          e.preventDefault();
          const selected = themeOptions[selectedThemeIndex];
          selectTheme(selected.key, selected.name);
        } else if (e.key === "Escape") {
          e.preventDefault();
          document.getElementById("themeMenu").classList.remove("show");
          document.removeEventListener("keydown", handleThemeNavigation);
        }
      }

      function updateThemeSelection() {
        const options = document.querySelectorAll(".theme-option");
        options.forEach((opt, index) => {
          opt.classList.toggle("active", index === selectedThemeIndex);
        });
      }

      function previewTheme(theme) {
        document.body.className = `theme-${theme.key}`;
        document.getElementById("currentTheme").textContent = theme.name;

        if (editor && monaco && monacoThemes[theme.key]) {
          try {
            monaco.editor.setTheme(monacoThemes[theme.key]);
          } catch (e) {
            setTimeout(() => {
              if (monaco && monacoThemes[theme.key]) {
                monaco.editor.setTheme(monacoThemes[theme.key]);
              }
            }, 100);
          }
        }
      }

      // Close theme menu when clicking outside
      document.addEventListener("click", (e) => {
        if (!e.target.closest(".theme-selector")) {
          const menu = document.getElementById("themeMenu");
          if (menu.classList.contains("show")) {
            menu.classList.remove("show");
            document.removeEventListener("keydown", handleThemeNavigation);
          }
        }
      });

      // Fullscreen toggle
      function toggleFullscreen() {
        if (!isFullscreen) {
          document.documentElement.requestFullscreen();
          isFullscreen = true;
        } else {
          document.exitFullscreen();
          isFullscreen = false;
        }
      }

      // Load saved preferences
      window.addEventListener("load", () => {
        const savedTheme =
          localStorage.getItem("jsPlaygroundTheme") || "vscode";
        const savedThemeDisplay =
          localStorage.getItem("jsPlaygroundThemeDisplay") || "VS Code";

        if (savedTheme !== "vscode") {
          document.body.className = `theme-${savedTheme}`;
          document.getElementById("currentTheme").textContent =
            savedThemeDisplay;

          // Update active option
          document.querySelectorAll(".theme-option").forEach((opt) => {
            opt.classList.remove("active");
            if (opt.onclick.toString().includes(savedTheme)) {
              opt.classList.add("active");
            }
          });

          currentTheme = savedTheme;

          // Apply Monaco theme after editor loads
          setTimeout(() => {
            if (editor && monaco && monacoThemes[savedTheme]) {
              monaco.editor.setTheme(monacoThemes[savedTheme]);
            }
          }, 200);
        }

        // Update headers after loading preferences
        setTimeout(() => {
          feather.replace();
        }, 100);
      });

      // Resizer functionality
      const resizer = document.getElementById("resizer");
      const container = document.querySelector(".container");
      const editorPanel = document.querySelector(".editor-panel");
      const outputPanel = document.querySelector(".output-panel");

      let startX, startEditorPercentage, startOutputPercentage;

      resizer.addEventListener("mousedown", (e) => {
        isResizing = true;
        startX = e.clientX;

        // Get current actual pixel widths (more reliable after sidebar resize)
        const currentEditorWidth = editorPanel.offsetWidth;
        const currentOutputWidth = outputPanel.offsetWidth;

        // Store initial widths for calculation
        startEditorPercentage = currentEditorWidth;
        startOutputPercentage = currentOutputWidth;

        document.addEventListener("mousemove", handleResize);
        document.addEventListener("mouseup", stopResize);
        e.preventDefault();
      });

      function handleResize(e) {
        if (!isResizing) return;

        const deltaX = e.clientX - startX;
        const containerRect = container.getBoundingClientRect();
        const sidebarElement = document.querySelector(".sidebar");
        const sidebarWidth = sidebarElement.offsetWidth + 4;
        const availableWidth = containerRect.width - sidebarWidth;

        // Use initial widths stored at mousedown
        const initialEditorWidth = startEditorPercentage;
        const initialOutputWidth = startOutputPercentage;

        // Calculate new widths based on mouse movement from initial position
        const newEditorWidth = initialEditorWidth + deltaX;
        const newOutputWidth = initialOutputWidth - deltaX;

        // Ensure minimum widths (at least 30% of available space)
        const minWidth = availableWidth * 0.3;
        const maxWidth = availableWidth * 0.7;

        if (
          newEditorWidth >= minWidth &&
          newEditorWidth <= maxWidth &&
          newOutputWidth >= minWidth &&
          newOutputWidth <= maxWidth
        ) {
          // Use pixel-based widths for more accurate resizing
          editorPanel.style.width = newEditorWidth + "px";
          outputPanel.style.width = newOutputWidth + "px";
          editorPanel.style.flex = "0 0 auto";
          outputPanel.style.flex = "0 0 auto";
        }
      }

      // Sidebar resizer
      const sidebarResizer = document.getElementById("sidebarResizer");
      const sidebar = document.querySelector(".sidebar");

      sidebarResizer.addEventListener("mousedown", (e) => {
        isResizingSidebar = true;
        document.addEventListener("mousemove", handleSidebarResize);
        document.addEventListener("mouseup", stopSidebarResize);
        e.preventDefault();
      });

      function handleSidebarResize(e) {
        if (!isResizingSidebar) return;
        const newWidth = e.clientX;
        if (newWidth >= 120 && newWidth <= 500) {
          sidebar.style.width = newWidth + "px";

          // When sidebar resizes, recalculate editor/output panel widths
          // to maintain proper proportions
          const containerRect = container.getBoundingClientRect();
          const availableWidth = containerRect.width - newWidth - 4;

          // If panels have percentage widths, convert to pixels
          // Otherwise maintain current pixel widths
          if (
            !editorPanel.style.width ||
            editorPanel.style.width.includes("%")
          ) {
            // Use flex-based layout initially
            editorPanel.style.width = "";
            outputPanel.style.width = "";
            editorPanel.style.flex = "1";
            outputPanel.style.flex = "1";
          }
        }
      }

      function stopSidebarResize() {
        isResizingSidebar = false;
        document.removeEventListener("mousemove", handleSidebarResize);
        document.removeEventListener("mouseup", stopSidebarResize);
      }

      function stopResize() {
        isResizing = false;
        document.removeEventListener("mousemove", handleResize);
        document.removeEventListener("mouseup", stopResize);
      }

      // Terminal management
      let terminalCounter = 0;

      function addTerminal() {
        const terminalId = terminalCounter++;
        const terminal = {
          id: terminalId,
          name: `Terminal ${terminalId + 1}`,
          output: [],
        };

        terminals.push(terminal);

        // Create tab
        const tab = document.createElement("button");
        tab.className = "terminal-tab";
        tab.dataset.terminalId = terminalId;
        tab.innerHTML = `
                <span>${terminal.name}</span>
                <span class="tab-close" onclick="closeTerminal(${terminalId}, event)">√ó</span>
            `;
        tab.onclick = (e) => {
          if (!e.target.classList.contains("tab-close")) {
            switchTerminal(terminalId);
          }
        };

        document
          .getElementById("terminalTabs")
          .insertBefore(tab, document.querySelector(".add-terminal"));

        // Create content
        const content = document.createElement("div");
        content.className = "terminal-content";
        content.id = `terminal-${terminalId}`;
        content.innerHTML = `
                <div class="output-header">
                    <span><i data-feather="terminal"></i> ${terminal.name}</span>
                    <div>
                        <button class="clear-btn" onclick="clearTerminal(${terminalId})"><i data-feather="trash-2"></i> Clear</button>
                    </div>
                </div>
                <div class="output-content" id="output-${terminalId}"></div>
                <div class="terminal-input">
                    <span class="prompt">></span>
                    <input type="text" class="input-line" id="input-${terminalId}" placeholder="Type command..." />
                </div>
            `;

        document.getElementById("terminalContainer").appendChild(content);

        // Add input event listener
        const inputLine = document.getElementById(`input-${terminalId}`);
        inputLine.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            handleTerminalInput(terminalId, inputLine.value);
            inputLine.value = "";
            // Ensure cursor is at start after clearing
            setTimeout(() => {
              inputLine.setSelectionRange(0, 0);
            }, 0);
          }
        });

        // Prevent any interference with normal text editing
        inputLine.addEventListener("input", (e) => {
          // Allow normal input handling - browser will handle cursor position
        });

        switchTerminal(terminalId);

        // Update feather icons
        setTimeout(() => feather.replace(), 10);
      }

      function switchTerminal(id) {
        // Update tabs
        document.querySelectorAll(".terminal-tab").forEach((tab) => {
          if (parseInt(tab.dataset.terminalId) === id) {
            tab.classList.add("active");
          } else {
            tab.classList.remove("active");
          }
        });

        // Update content
        document.querySelectorAll(".terminal-content").forEach((content) => {
          const contentId = parseInt(content.id.split("-")[1]);
          if (contentId === id) {
            content.classList.add("active");
          } else {
            content.classList.remove("active");
          }
        });

        activeTerminal = id;
      }

      function closeTerminal(id, event) {
        event.stopPropagation();

        if (terminals.length <= 1) return; // Keep at least one terminal

        // Remove tab and content
        const tab = document.querySelector(`[data-terminal-id="${id}"]`);
        const content = document.getElementById(`terminal-${id}`);

        if (tab) tab.remove();
        if (content) content.remove();

        // Remove from terminals array
        terminals = terminals.filter((t) => t.id !== id);

        // Switch to first available terminal if current was closed
        if (activeTerminal === id && terminals.length > 0) {
          switchTerminal(terminals[0].id);
        }
      }

      function clearTerminal(id) {
        const output = document.getElementById(`output-${id}`);
        if (output) {
          output.innerHTML = "";
        }
        const terminal = terminals.find((t) => t.id === id);
        if (terminal) {
          terminal.output = [];
        }
      }

      // Python runtime using PyScript
      let pyscriptReady = false;

      function initPyScript() {
        if (pyscriptReady) return;

        // Wait for PyScript to be ready
        document.addEventListener("py:ready", () => {
          pyscriptReady = true;
          addLogEntry("Python runtime loaded successfully!", "info");
        });

        // Handle PyScript errors
        document.addEventListener("py:error", (event) => {
          addLogEntry("Python Error: " + event.detail.message, "error");
        });
      }

      async function executePythonCode(code) {
        try {
          // Simple approach: use eval with Python-like syntax simulation
          // This is a basic implementation for demonstration
          const lines = code.split("\n");
          let output = "";

          for (const line of lines) {
            const trimmed = line.trim();
            if (trimmed.startsWith("print(")) {
              // Extract content from print statement
              const match = trimmed.match(/print\((.+)\)/);
              if (match) {
                let content = match[1];
                // Remove quotes if present
                content = content.replace(/^["']|["']$/g, "");
                // Handle f-strings and variables (basic)
                content = content.replace(/f["']([^"']*)["']/, "$1");
                output += content + "\n";
              }
            } else if (trimmed.startsWith("#") || trimmed === "") {
              // Skip comments and empty lines
              continue;
            } else if (trimmed.includes("=")) {
              // Basic variable assignment (for demo)
              output += `Executed: ${trimmed}\n`;
            }
          }

          if (output) {
            addLogEntry(output.trim(), "info");
          } else {
            addLogEntry("Code executed successfully", "info");
          }
        } catch (error) {
          addLogEntry("Python Error: " + error.message, "error");
        }
      }

      // Code execution
      function runCode() {
        let code = editor.getValue();
        const outputElement = document.getElementById(
          `output-${activeTerminal}`
        );
        const extension = currentFile.split(".").pop().toLowerCase();

        // Add separator if there's existing output
        if (outputElement.children.length > 0) {
          const separator = document.createElement("div");
          separator.style.cssText =
            "border-top: 1px solid var(--border); margin: 8px 0; opacity: 0.5;";
          outputElement.appendChild(separator);
        }

        if (extension === "py") {
          executePythonCode(code);
        } else {
          // Check if code contains prompt() calls
          if (code.includes("prompt(")) {
            handleInteractiveCode(code);
            return;
          }
          executeCode(code);
        }
      }

      function handleInteractiveCode(code) {
        // Find first prompt call
        const promptMatch = code.match(
          /prompt\s*\(\s*["'`]([^"'`]*)["'`]\s*(?:,\s*["'`]([^"'`]*)["'`])?\s*\)/
        );
        if (promptMatch) {
          const message = promptMatch[1];
          const defaultValue = promptMatch[2] || "";

          showTerminalPrompt(message, defaultValue, (userInput) => {
            // Replace the prompt call with the user input
            const modifiedCode = code.replace(promptMatch[0], `"${userInput}"`);

            // Add separator if there's existing output
            const outputElement = document.getElementById(
              `output-${activeTerminal}`
            );
            if (outputElement.children.length > 0) {
              const separator = document.createElement("div");
              separator.style.cssText =
                "border-top: 1px solid var(--border); margin: 8px 0; opacity: 0.5;";
              outputElement.appendChild(separator);
            }

            executeCode(modifiedCode);
          });
        }
      }

      let hasOutput = false;
      let executionStartTime = 0;
      
      function executeCode(code) {
        hasOutput = false;
        executionStartTime = Date.now();
        
        // Create sandboxed iframe for execution
        const iframe = document.createElement("iframe");
        iframe.style.display = "none";
        document.body.appendChild(iframe);

        const iframeDoc =
          iframe.contentDocument || iframe.contentWindow.document;

        // Override console methods in iframe
        const script = iframeDoc.createElement("script");
        script.textContent = `
                // Interactive prompt system
                window.prompt = function(message, defaultValue) {
                    window.parent.postMessage({
                        type: 'prompt',
                        message: message,
                        defaultValue: defaultValue || '',
                        terminalId: ${activeTerminal}
                    }, '*');
                    // This will be replaced by actual user input
                    return '__PROMPT_PLACEHOLDER__';
                };
                window.alert = function() { };
                window.confirm = function() { return false; };
                
                console.log = function(...args) {
                    window.parent.postMessage({
                        type: 'log',
                        level: 'info',
                        terminalId: ${activeTerminal},
                        message: args.map(arg => 
                            typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                        ).join(' ')
                    }, '*');
                };

                console.error = function(...args) {
                    window.parent.postMessage({
                        type: 'log',
                        level: 'error',
                        terminalId: ${activeTerminal},
                        message: args.map(arg => String(arg)).join(' ')
                    }, '*');
                };

                console.warn = function(...args) {
                    window.parent.postMessage({
                        type: 'log',
                        level: 'warn',
                        terminalId: ${activeTerminal},
                        message: args.map(arg => String(arg)).join(' ')
                    }, '*');
                };

                window.onerror = function(message, source, lineno, colno, error) {
                    window.parent.postMessage({
                        type: 'log',
                        level: 'error',
                        terminalId: ${activeTerminal},
                        message: 'Error: ' + message + (lineno ? ' (line ' + lineno + ')' : '')
                    }, '*');
                    return true;
                };

                try {
                    ${code}
                    // Signal completion
                    window.parent.postMessage({
                        type: 'execution-complete',
                        terminalId: ${activeTerminal}
                    }, '*');
                } catch (error) {
                    window.parent.postMessage({
                        type: 'log',
                        level: 'error',
                        terminalId: ${activeTerminal},
                        message: 'Error: ' + error.message
                    }, '*');
                }
            `;

        iframeDoc.head.appendChild(script);

        // Clean up iframe after execution
        setTimeout(() => {
          document.body.removeChild(iframe);
        }, 1000);
      }

      // Handle messages from iframe
      window.addEventListener("message", function (event) {
        if (event.data.type === "log") {
          hasOutput = true;
          addLogEntry(
            event.data.message,
            event.data.level,
            event.data.terminalId
          );
        } else if (event.data.type === "execution-complete") {
          // Check if no output was generated after a brief delay
          setTimeout(() => {
            if (!hasOutput) {
              addLogEntry("Code executed successfully", "info", event.data.terminalId);
            }
          }, 100);
        }
      });

      function addLogEntry(
        message,
        level = "info",
        terminalId = activeTerminal
      ) {
        const output = document.getElementById(`output-${terminalId}`);
        if (!output) return;

        const entry = document.createElement("div");
        entry.className = `log-entry log-${level}`;
        entry.textContent = message;
        output.appendChild(entry);

        // Force scroll to bottom with multiple attempts
        const scrollToBottom = () => {
          output.scrollTop = output.scrollHeight;
        };

        requestAnimationFrame(scrollToBottom);
        setTimeout(scrollToBottom, 10);
        setTimeout(scrollToBottom, 50);

        // Store in terminal history
        const terminal = terminals.find((t) => t.id === terminalId);
        if (terminal) {
          terminal.output.push({ message, level });
        }
      }

      let pendingPrompt = null;

      function showTerminalPrompt(message, defaultValue = "", callback) {
        addLogEntry(message, "info");
        const inputLine = document.getElementById(`input-${activeTerminal}`);
        inputLine.value = defaultValue;
        inputLine.placeholder = "Type your answer and press Enter...";
        inputLine.focus();
        // Restore cursor position to end of text
        setTimeout(() => {
          const length = inputLine.value.length;
          inputLine.setSelectionRange(length, length);
        }, 0);
        pendingPrompt = callback;
      }

      function handleTerminalInput(terminalId, input) {
        // Show the input in terminal
        addLogEntry(`> ${input}`, "info", terminalId);

        if (pendingPrompt) {
          pendingPrompt(input);
          pendingPrompt = null;
          const inputLine = document.getElementById(`input-${terminalId}`);
          inputLine.placeholder = "Type command...";
          inputLine.value = "";
          // Reset cursor position
          setTimeout(() => {
            inputLine.setSelectionRange(0, 0);
          }, 0);
          return;
        }

        // Handle basic terminal commands
        const cmd = input.trim().toLowerCase();
        if (cmd === "clear") {
          clearTerminal(terminalId);
        } else if (cmd === "help") {
          addLogEntry(
            "Available commands: clear, help, run, files",
            "info",
            terminalId
          );
        } else if (cmd === "run") {
          runCode();
        } else if (cmd === "files") {
          addLogEntry(
            "Files: " + Object.keys(files).join(", "),
            "info",
            terminalId
          );
        } else if (cmd) {
          addLogEntry(`Unknown command: ${input}`, "error", terminalId);
        }
      }

      // VS Code-style file management functions
      function createNewFile() {
        const tree = document.getElementById("fileTree");
        const input = document.createElement("input");
        input.className = "inline-input";
        input.type = "text";
        input.placeholder = "filename.js";
        input.value = "";
        
        const container = document.createElement("div");
        container.className = "file-item";
        container.innerHTML = `<i data-feather="file-text"></i>`;
        container.appendChild(input);
        
        tree.insertBefore(container, tree.firstChild);
        input.focus();
        
        const finishCreation = () => {
          const name = input.value.trim();
          if (name && !files[name]) {
            const extension = name.split(".").pop().toLowerCase();
            if (extension === "py") {
              files[name] = '# New Python file\nprint("Hello from ' + name + '")';
            } else {
              files[name] = '// New JavaScript file\nconsole.log("Hello from ' + name + '");';
            }
            saveFilesToStorage();
            renderFileTree();
            openFile(name);
          } else {
            container.remove();
          }
        };
        
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            finishCreation();
          } else if (e.key === "Escape") {
            e.preventDefault();
            container.remove();
          }
        });
        
        input.addEventListener("blur", finishCreation);
        
        setTimeout(() => feather.replace(), 10);
      }
      
      function createNewFolder() {
        const tree = document.getElementById("fileTree");
        const input = document.createElement("input");
        input.className = "inline-input";
        input.type = "text";
        input.placeholder = "folder name";
        input.value = "";
        
        const container = document.createElement("div");
        container.className = "folder-item";
        container.innerHTML = `<i data-feather="folder"></i>`;
        container.appendChild(input);
        
        tree.insertBefore(container, tree.firstChild);
        input.focus();
        
        const finishCreation = () => {
          const name = input.value.trim();
          if (name && !folders[name]) {
            folders[name] = [];
            localStorage.setItem("jsPlaygroundFolders", JSON.stringify(folders));
            renderFileTree();
          } else {
            container.remove();
          }
        };
        
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            finishCreation();
          } else if (e.key === "Escape") {
            e.preventDefault();
            container.remove();
          }
        });
        
        input.addEventListener("blur", finishCreation);
        
        setTimeout(() => feather.replace(), 10);
      }

      // File system management
      function renderFileTree() {
        const tree = document.getElementById("fileTree");
        tree.innerHTML = "";
        
        // Render folders first
        Object.keys(folders).forEach((folderName) => {
          const folderItem = document.createElement("div");
          folderItem.className = "folder-item";
          const isExpanded = expandedFolders.has(folderName);
          folderItem.innerHTML = `
            <i data-feather="${isExpanded ? 'chevron-down' : 'chevron-right'}"></i>
            <i data-feather="folder${isExpanded ? '-open' : ''}"></i>
            ${folderName}
          `;
          
          folderItem.onclick = (e) => {
            e.stopPropagation();
            toggleFolder(folderName);
          };
          
          // Add right-click context menu for folder actions
          folderItem.oncontextmenu = (e) => {
            e.preventDefault();
            showContextMenu(e, folderName, 'folder');
          };
          
          tree.appendChild(folderItem);
          
          // Render folder contents if expanded
          if (isExpanded) {
            const folderContents = document.createElement("div");
            folderContents.className = "folder-contents expanded";
            
            folders[folderName].forEach((filename) => {
              const item = document.createElement("div");
              item.className = `file-item in-folder ${
                filename === currentFile ? "active" : ""
              }`;
              item.innerHTML = `<i data-feather="file-text"></i> ${filename.split('/').pop()}`;
              item.onclick = () => openFile(filename);
              item.oncontextmenu = (e) => {
                e.preventDefault();
                showContextMenu(e, filename, 'file');
              };
              folderContents.appendChild(item);
            });
            
            tree.appendChild(folderContents);
          }
        });
        
        // Render root files
        Object.keys(files).forEach((filename) => {
          if (!filename.includes('/')) {
            const item = document.createElement("div");
            item.className = `file-item ${
              filename === currentFile ? "active" : ""
            }`;
            item.innerHTML = `<i data-feather="file-text"></i> ${filename}`;
            item.onclick = () => openFile(filename);
            item.oncontextmenu = (e) => {
              e.preventDefault();
              showContextMenu(e, filename, 'file');
            };
            tree.appendChild(item);
          }
        });
        
        setTimeout(() => feather.replace(), 10);
      }
      
      function toggleFolder(folderName) {
        if (expandedFolders.has(folderName)) {
          expandedFolders.delete(folderName);
        } else {
          expandedFolders.add(folderName);
        }
        renderFileTree();
      }
      
      function createFileInFolder(folderName) {
        const tree = document.getElementById("fileTree");
        const input = document.createElement("input");
        input.className = "inline-input";
        input.type = "text";
        input.placeholder = "filename.js";
        input.value = "";
        
        const container = document.createElement("div");
        container.className = "file-item in-folder";
        container.innerHTML = `<i data-feather="file-text"></i>`;
        container.appendChild(input);
        
        // Ensure folder is expanded first
        if (!expandedFolders.has(folderName)) {
          expandedFolders.add(folderName);
          renderFileTree();
          // Re-run after render to find the expanded folder contents
          setTimeout(() => {
            const folderContents = tree.querySelector('.folder-contents.expanded');
            if (folderContents) {
              folderContents.appendChild(container);
            } else {
              tree.appendChild(container);
            }
            input.focus();
          }, 50);
          return;
        }
        
        // Find folder contents and add input there
        const folderContents = tree.querySelector('.folder-contents.expanded');
        if (folderContents) {
          folderContents.appendChild(container);
        } else {
          tree.appendChild(container);
        }
        
        input.focus();
        
        const finishCreation = () => {
          const name = input.value.trim();
          if (name) {
            const fullPath = `${folderName}/${name}`;
            if (!files[fullPath]) {
              const extension = name.split(".").pop().toLowerCase();
              if (extension === "py") {
                files[fullPath] = '# New Python file\nprint("Hello from ' + name + '")';
              } else {
                files[fullPath] = '// New JavaScript file\nconsole.log("Hello from ' + name + '");';
              }
              folders[folderName].push(fullPath);
              saveFilesToStorage();
              localStorage.setItem("jsPlaygroundFolders", JSON.stringify(folders));
              renderFileTree();
              openFile(fullPath);
            }
          }
          container.remove();
        };
        
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            finishCreation();
          } else if (e.key === "Escape") {
            e.preventDefault();
            container.remove();
          }
        });
        
        input.addEventListener("blur", finishCreation);
        
        setTimeout(() => feather.replace(), 10);
      }

      function openFile(filename) {
        if (files[filename] !== undefined) {
          currentFile = filename;

          // Save current cursor position if switching files
          const position = editor.getPosition();

          editor.setValue(files[filename]);

          // Set language based on file extension
          const extension = filename.split(".").pop().toLowerCase();
          const language = extension === "py" ? "python" : "javascript";
          monaco.editor.setModelLanguage(editor.getModel(), language);

          // Restore cursor position or set to beginning
          setTimeout(() => {
            if (position) {
              editor.setPosition(position);
            } else {
              editor.setPosition({ lineNumber: 1, column: 1 });
            }
            editor.focus();
            editor.layout();
          }, 50);

          renderFileTree();
        }
      }



      function renameFile(oldName) {
        // Find the item in the tree and replace with input
        const tree = document.getElementById('fileTree');
        const items = tree.querySelectorAll('.file-item, .folder-item');
        
        for (let item of items) {
          const itemText = item.textContent.trim();
          const displayName = oldName.includes('/') ? oldName.split('/').pop() : oldName;
          
          if (itemText === displayName || itemText === oldName) {
            const input = document.createElement('input');
            input.className = 'inline-input';
            input.type = 'text';
            input.value = displayName;
            
            // Store original content
            const originalContent = item.innerHTML;
            
            // Replace item content with input
            item.innerHTML = '';
            item.appendChild(input);
            input.focus();
            input.select();
            
            const finishRename = () => {
              const newName = input.value.trim();
              if (newName && newName !== displayName) {
                const fullNewName = oldName.includes('/') ? 
                  oldName.substring(0, oldName.lastIndexOf('/') + 1) + newName : newName;
                
                if (!files[fullNewName] && !folders[newName]) {
                  if (contextType === 'folder') {
                    // Rename folder
                    folders[newName] = folders[oldName];
                    delete folders[oldName];
                    expandedFolders.delete(oldName);
                    if (expandedFolders.has(oldName)) {
                      expandedFolders.add(newName);
                    }
                    localStorage.setItem('jsPlaygroundFolders', JSON.stringify(folders));
                  } else {
                    // Rename file
                    files[fullNewName] = files[oldName];
                    delete files[oldName];
                    
                    // Update folder references
                    Object.keys(folders).forEach(folderName => {
                      const index = folders[folderName].indexOf(oldName);
                      if (index > -1) {
                        folders[folderName][index] = fullNewName;
                      }
                    });
                    
                    if (currentFile === oldName) {
                      currentFile = fullNewName;
                    }
                    
                    saveFilesToStorage();
                    localStorage.setItem('jsPlaygroundFolders', JSON.stringify(folders));
                  }
                  
                  renderFileTree();
                  return;
                }
              }
              
              // Restore original content if rename failed/cancelled
              item.innerHTML = originalContent;
              setTimeout(() => feather.replace(), 10);
            };
            
            input.addEventListener('keydown', (e) => {
              if (e.key === 'Enter') {
                e.preventDefault();
                finishRename();
              } else if (e.key === 'Escape') {
                e.preventDefault();
                item.innerHTML = originalContent;
                setTimeout(() => feather.replace(), 10);
              }
            });
            
            input.addEventListener('blur', finishRename);
            break;
          }
        }
      }

      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebarVisible = !sidebarVisible;
        sidebar.classList.toggle("hidden", !sidebarVisible);
      }

      // Fullscreen event listeners
      document.addEventListener("fullscreenchange", () => {
        isFullscreen = !!document.fullscreenElement;
      });

      function toggleBottomBar() {
        const bottomBar = document.getElementById("bottomBar");
        bottomBarVisible = !bottomBarVisible;
        bottomBar.classList.toggle("hidden", !bottomBarVisible);

        // Adjust container height
        const container = document.querySelector(".container");
        container.style.height = bottomBarVisible
          ? "calc(100vh - 110px)"
          : "calc(100vh - 50px)";
      }

      // About modal functions
      function showAbout() {
        document.getElementById("aboutModal").classList.add("show");
      }

      function hideAbout() {
        document.getElementById("aboutModal").classList.remove("show");
      }

      function showUpdates() {
        hideAbout();
        document.getElementById("updatesModal").classList.add("show");
      }

      function hideUpdates() {
        document.getElementById("updatesModal").classList.remove("show");
      }

      // Close modal when clicking outside
      document.getElementById("aboutModal").addEventListener("click", (e) => {
        if (e.target.id === "aboutModal") {
          hideAbout();
        }
      });

      document.getElementById("updatesModal").addEventListener("click", (e) => {
        if (e.target.id === "updatesModal") {
          hideUpdates();
        }
      });

      // Context menu functions
      function showContextMenu(event, target, type) {
        contextTarget = target;
        contextType = type;
        
        const menu = document.getElementById('contextMenu');
        
        // Update menu content based on context
        if (type === 'file') {
          menu.innerHTML = `
            <div class="context-menu-item" onclick="contextRename()">
              <i data-feather="edit-2"></i> Rename
            </div>
            <div class="context-menu-item" onclick="contextCopy()">
              <i data-feather="copy"></i> Copy
            </div>
            <div class="context-menu-item" onclick="contextDelete()">
              <i data-feather="trash-2"></i> Delete
            </div>
          `;
        } else {
          // For folders and empty space
          menu.innerHTML = `
            <div class="context-menu-item" onclick="contextNewFile()">
              <i data-feather="file-plus"></i> New File
            </div>
            <div class="context-menu-item" onclick="contextNewFolder()">
              <i data-feather="folder-plus"></i> New Folder
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" onclick="contextRename()">
              <i data-feather="edit-2"></i> Rename
            </div>
            <div class="context-menu-item" onclick="contextDelete()">
              <i data-feather="trash-2"></i> Delete
            </div>
          `;
        }
        
        menu.style.left = event.pageX + 'px';
        menu.style.top = event.pageY + 'px';
        menu.classList.add('show');
        
        // Update feather icons
        setTimeout(() => feather.replace(), 10);
      }
      
      function hideContextMenu() {
        document.getElementById('contextMenu').classList.remove('show');
        contextTarget = null;
        contextType = null;
      }
      
      function contextNewFile() {
        if (contextType === 'folder') {
          createFileInFolder(contextTarget);
        } else {
          createNewFile();
        }
        hideContextMenu();
      }
      
      function contextNewFolder() {
        createNewFolder();
        hideContextMenu();
      }
      
      function contextRename() {
        if (contextTarget) {
          renameFile(contextTarget);
        }
        hideContextMenu();
      }
      
      function contextCopy() {
        if (contextTarget && files[contextTarget]) {
          const content = files[contextTarget];
          const extension = contextTarget.split('.').pop();
          const baseName = contextTarget.replace(/\.[^/.]+$/, "");
          const copyName = `${baseName}_copy.${extension}`;
          
          if (!files[copyName]) {
            files[copyName] = content;
            saveFilesToStorage();
            renderFileTree();
          }
        }
        hideContextMenu();
      }
      
      function contextDelete() {
        if (contextTarget) {
          if (contextType === 'folder') {
            // Delete folder and all its files
            if (folders[contextTarget]) {
              folders[contextTarget].forEach(filename => {
                delete files[filename];
              });
              delete folders[contextTarget];
              expandedFolders.delete(contextTarget);
              localStorage.setItem('jsPlaygroundFolders', JSON.stringify(folders));
              saveFilesToStorage();
              renderFileTree();
            }
          } else {
            // Delete file
            if (Object.keys(files).length > 1) {
              delete files[contextTarget];
              
              // Remove from folder if it's in one
              Object.keys(folders).forEach(folderName => {
                const index = folders[folderName].indexOf(contextTarget);
                if (index > -1) {
                  folders[folderName].splice(index, 1);
                }
              });
              
              if (currentFile === contextTarget) {
                const remaining = Object.keys(files);
                currentFile = remaining[0];
                editor.setValue(files[currentFile]);
              }
              
              localStorage.setItem('jsPlaygroundFolders', JSON.stringify(folders));
              saveFilesToStorage();
              renderFileTree();
            }
          }
        }
        hideContextMenu();
      }
      
      // Hide context menu when clicking elsewhere
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.context-menu')) {
          hideContextMenu();
        }
      });
      
      // Add right-click to empty space in file tree
      document.getElementById('fileTree').addEventListener('contextmenu', (e) => {
        if (e.target.id === 'fileTree') {
          e.preventDefault();
          showContextMenu(e, null, 'empty');
        }
      });

      // Global keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.key === "b") {
          e.preventDefault();
          toggleSidebar();
        }
        if (e.ctrlKey && e.key === "`") {
          e.preventDefault();
          toggleBottomBar();
        }
        if (e.key === "Escape") {
          hideAbout();
          hideUpdates();
          hideContextMenu();
        }
      });
    </script>
  </body>
</html>
